<% layout('layouts/boilerplate') -%>
<% if (success && success.length) { %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= success[0] %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
<% } %>

<div class="container mt-5 mb-5">

  <h2 class="text-center mb-4">Listing Details</h2>

  <div class="row justify-content-center">
    <div class="col-md-7 col-lg-6">

      <div class="card shadow-lg border-0 rounded-4">

        <!-- IMAGE -->
        <img 
          src="<%= listing.image.url %>" 
          class="card-img-top rounded-top-4"
          style="height: 300px; object-fit: cover;"
          alt="listing image"
        >

        <!-- BODY -->
        <div class="card-body">

          <h4 class="card-title fw-bold">
            <%= listing.title %>
          </h4>

          <p class="card-text text-muted">
            <%= listing.description %>
          </p>

          <p class="fw-semibold mb-1">
            â‚¹ <%= listing.price.toLocaleString("en-IN") %>
          </p>

          <p class="mb-0">
            <%= listing.location %>
          </p>

          <p class="text-muted">
            <%= listing.country %>
          </p>

          <!-- BUTTONS -->
          <div class="d-flex gap-3 mt-4">

            <a 
              href="/listings/<%= listing._id %>/edit"
              class="btn btn-danger px-4"
            >
              Edit
            </a>

            <form 
              method="POST" 
              action="/listings/<%= listing._id %>?_method=DELETE"
            >
              <button class="btn btn-dark px-4">
                Delete
              </button>
            </form>

          </div>
<div class="col-8 offset-2 mt-5">
  <hr class="mb-4">

  <h4 class="mb-3 fw-semibold">Leave a Review</h4>

  <form class="needs-validation" novalidate method="post" action="/listings/<%= listing._id %>/reviews">

    <!-- Rating -->
    <div class="mb-3">
      <label for="rating" class="form-label fw-semibold">
        Rating (1 to 5)
      </label>
      <input 
        type="range"
        class="form-range"
        min="1"
        max="5"
        id="rating"
        name="review[rating]"
      >
      <div class="d-flex justify-content-between text-muted">
        <small>1</small>
        <small>2</small>
        <small>3</small>
        <small>4</small>
        <small>5</small>
      </div>
    </div>

    <!-- Comment -->
    <div class="mb-3">
      <label for="comment" class="form-label fw-semibold">
        Comment
      </label>
      <textarea
        class="form-control"
        name="review[Comment]"
        id="comment"
        rows="4"
        placeholder="Share your experience..."
        required
      ></textarea>
      <div class="invalid-feedback">
        Please write a comment.
      </div>

      
      
    </div>

    <!-- Submit -->
    <button class="btn btn-danger px-4">
      Submit Review
    </button>

  </form>
  <hr class="my-4">

<h4 class="mb-4">All Reviews</h4>

<div class="row">
  <% if (listing.reviews.length === 0) { %>
    <p class="text-muted">No reviews yet.</p>
  <% } %>

  <% for (let review of listing.reviews) { %>
    <div class="col-md-6 mb-4">
      <div class="card h-100 shadow-sm border-0">
        <div class="card-body">

          <!-- User name (static for now) -->
          <h6 class="fw-bold mb-2">Jane Doe</h6>

          <!-- COMMENT -->
          <p class="text-muted mb-3">
            <%= review.Comment %>
          </p>

          <!-- RATING -->
          <span class="badge bg-warning text-dark">
            <%= review.rating %> stars
          </span>

        </div>
       <form 
  method="post" 
  action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE"
  class="mt-3"
>
  <button class="btn btn-outline-danger btn-sm">
    <i class="bi bi-trash"></i> Delete
  </button>
</form>

      </div>
      
    </div>
    
  <% } %>
</div>

</div>

</div>

        </div>
      </div>

    </div>
  </div>

</div>
